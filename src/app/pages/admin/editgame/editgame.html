<div class="container">
  <app-header></app-header>

  <div class="editgame">
    <div class="editgame-header">
      <h2 class="title">Edit Game</h2>
    </div>

    <div class="form-container">
      <form #registerForm="ngForm" (ngSubmit)="savegame()" enctype="multipart/form-data">

        <!-- Image upload -->
        <div class="image-upload" (click)="fileInput.click()">
          <ng-container *ngIf="!previewUrl; else preview">
            <div class="image-placeholder">
              <i class="fa-regular fa-image"></i>
            </div>
          </ng-container>
          <ng-template #preview>
            <img [src]="previewUrl" alt="preview" class="preview-img" />
            <button type="button" class="remove-btn" (click)="removeImage()">×</button>
          </ng-template>
          <input
            type="file"
            accept="image/*"
            #fileInput
            (change)="onFileSelected($event)"
            hidden
          />
        </div>

        <!-- Input fields -->
        <input
          type="text"
          name="title"
          placeholder="Name"
          [(ngModel)]="game.title"
          required
          #title="ngModel"
        />
        <p *ngIf="title.invalid && (title.dirty || title.touched)" class="error-message">
          กรุณากรอกชื่อเกม
        </p>

        <input
          type="number"
          name="price"
          placeholder="Price"
          [(ngModel)]="game.price"
          required
          #price="ngModel"
        />
        <p *ngIf="price.invalid && (price.dirty || price.touched)" class="error-message">
          กรุณากรอกราคา
        </p>

        <!-- Custom category select -->
        <div class="category-selector">
          <div class="selected-area" (click)="toggleDropdown()">
            <div class="tags">
              <span *ngFor="let cat of selectedCategories" class="tag">
                {{ cat }}
                <button type="button" (click)="removeCategory(cat)">×</button>
              </span>
              <span class="placeholder" *ngIf="!selectedCategories.length">เลือกหมวดหมู่เกม</span>
            </div>
            <i class="fa-solid fa-chevron-down"></i>
          </div>

          <div class="dropdown" *ngIf="dropdownOpen">
            <div
              class="dropdown-item"
              *ngFor="let cat of categories"
              (click)="toggleCategory(cat)"
              [class.active]="selectedCategories.includes(cat)"
            >
              {{ cat }}
              <span *ngIf="selectedCategories.includes(cat)">✔</span>
            </div>
          </div>
        </div>

        <!-- Date picker -->
        <input
          type="date"
          name="release_date"
          [(ngModel)]="game.release_date"
          required
        />

        <textarea
          name="description"
          placeholder="Description"
          [(ngModel)]="game.description"
        ></textarea>

        <input
          type="number"
          name="bestseller_rank"
          placeholder="Best Seller Rank"
          [(ngModel)]="game.bestseller_rank"
        />

        <!-- Status message -->
        <p *ngIf="message" [class.error]="isError" [class.success]="!isError">{{ message }}</p>

        <!-- Button -->
        <button type="submit" [disabled]="isLoading">
          {{ isLoading ? 'Loading...' : 'Continue' }}
        </button>
      </form>
    </div>
  </div>
</div>
